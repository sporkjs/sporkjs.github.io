<!doctype html>
<html>
<head>
<script>
function fixExponents(s){
	var i=0;
	var re1=/:OP(\d+):([^]*):CP\1:\s*\^\s*:OP(\d+):([^]*):CP\3:/
	var re2=/:OP(\d+):([^]*):CP\1:\s*\^\s*(\w*)/
	var re3=/(\w*)\s*\^\s*:OP(\d+):([^]*):CP\2:/
	var re4=/(\w*)\s*\^\s*(\w*)/
	while (s.search(/\(([^()]*)\)/)!=-1){
		s=s.replace(/\(([^()]*)\)/, ':OP'+i+':$1:CP'+i+':');
		i++;
	}
	while (s.search(re1) != -1)
		s=s.replace(re1,"pow($2,$4)");
	while (s.search(re2) != -1)
		s=s.replace(re2,"pow($2,$3)");
	while (s.search(re3) != -1)
		s=s.replace(re3,"pow($1,$3)");
	while (s.search(re4) != -1)
		s=s.replace(re4,"pow($1,$2)");
	while (s.search(/:OP\d+:/) != -1)
		s=s.replace(/:OP\d+:/,'(');
	while (s.search(/:CP\d+:/) != -1)
		s=s.replace(/:CP\d+:/,')');
	return(s);
}
</script>
</head>
<body>
<input type='text' id='input'>
<div id='output'>output</div>
<button onclick='output.innerHTML=fixExponents(input.value);'>go</button>
</body>
</html>