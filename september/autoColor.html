<!doctype html>
<html>
<head>
<script src='spork.js'></script>
<script>
//Random stuff-------------------------------------------------------
var RNGMOD=Math.pow(2,32);
var RNGSEED=0;

function RNG(){
	RNGSEED=(RNGSEED*1664525 + 1013904223)%RNGMOD;
  	return(RNGSEED/RNGMOD);
}
//----------------------------------------------------------------------------

//color wheel stuff--------------------------------------------------
function cCycle(d){
  var r;
  while(d<0) d+=360;
  d=d%360;
  if ((d<60) || (d>300)) r=255;
  else if ((120<d) && (d<240)) r=0;
  else if (d<=120) r=floor(255-255*(d-60)/60);
  else r=floor(255*(d-240)/60);
  return(r)
}
function cColor(d){
  return(rgb(cCycle(d), cCycle(d-120), cCycle(d+120)))
}
//----------------------------------------------------------------------

function MUL(x,y){
	return(x*y);
}
function P1(x,y){
	return(x);
}
function P2(x,y){
	return(y)
}
function SINPI(x,y){
	return(sin(x*pi));
}
function COSPI(x,y){
	return(cos(x*pi));
}
function SIN2PI(x,y){
	return(sin(2*x*pi));
}
function COS2PI(x,y){
	return(cos(2*x*pi));
}
function SIN3PI(x,y){
	return(sin(3*x*pi));
}
function COS3PI(x,y){
	return(cos(3*x*pi));
}
function CUBE(x,y){
	return(x*x*x);
}
function SINXXYY(x,y){
	return(sin(pi*(x*x+y*y)));
}
function SINXXXYYY(x,y){
	return(sin(pi*(x*x*x+y*y*y)));
}
function SQUARE(x,y){
	return(x*x);
}
function AVG(x,y){
	return((x+y)/2);
}
var theFunctions=['P1','P2','MUL', 'SINPI', 'COSPI','CUBE','SINXXYY','max','min','SIN2PI','COS2PI','AVG'];
function randomFunction(n){
	var r,s,t,u;
	if (n==1){
		if (random()<0.5)
			r='P1(x,y)'
		else
			r='P2(x,y)';
	}
	else{
		s=randomFunction(n-1);
		t=randomFunction(n-1);
		u=theFunctions.random();
		r=u+'('+s+','+t+')';
	}
	return(r);
}
 var av=[];
 var theColors=[];
 function diff(){
	var x,y;
	var dx=0;
	var dy=0;
	for (x=0;x<width;x++)
	 for (y=0;y<height-1;y++)
	  dy+=abs(av[x][y]-av[x][y+1])*256;
	 dy=dy/(width*height);
	for (y=0;y<height;y++)
	for (x=0;x<width-1;x++)
	 dx+=abs(av[x][y]-av[x+1][y])*256;
	 dx=dx/(width*height);
	 return(min(dx,dy));
}
function setup(){
	size(300,300);
	var x, y;
	for (x=0;x<width;x++)
		av[x]=[];
	random=RNG;
	RNGSEED=millisecond();
	loop();
  }

function draw(){
//	clear();
	var x,y,a,b,c,d,cr,cg,cb;
	var r1=floor(random()*256);
	var g1=floor(random()*256);
	var b1=floor(random()*256);
	var fr=randomFunction(4+floor(random()*4));
	var fg=randomFunction(4+floor(random()*4));
	var fb=randomFunction(4+floor(random()*4));
	for (a=0;a<width;a++)
		for (b=0;b<height;b++){
			x=2*a/width-1;
			y=2*b/height-1;
			cr=eval(fr);
			av[a][b]=cr;
//			fillcolor(floor(cr*r1+(1-cr)*(256-r1)), floor(cr*g1+(1-cr)*(256-g1)), floor(cr*b1+(1-cr)*(256-b1)));
//			fillrect(a,b,1,1);
		}
	
	if (diff()>1){
	for (a=0;a<width;a++)
		for (b=0;b<height;b++){
			cr=av[a][b];
			fillcolor(floor(cr*r1+(1-cr)*(256-r1)), floor(cr*g1+(1-cr)*(256-g1)), floor(cr*b1+(1-cr)*(256-b1)));
			fillrect(a,b,1,1);
		}
		canvasToNewImg();
	}
}
</script>
</head>
<body>
<div class='cell'>
<div id='spork'></div> 
</div>
</body>
</html>