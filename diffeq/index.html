<!doctype html>
<html>
<head>
<style>
table{
	text-align: center;
}
#cover{
	position: fixed;
	left: 0px;
	top: 0px;
	right: 0px;
	bottom:0px;
	background: rgba(100,100,100,0.5);
	z-index: 5;
	display: none;
}
.rightalign{
	text-align: right;
}
div.fraction{
	display: inline-block;
	vertical-align: middle;
}
div.numerator{
	text-align: center;
	margin: 0px;
	border-bottom: 1px solid black;
}
div.denominator{
	text-align: center;
	margin: 0px;
}
.equation{
	display: none;
}
.graphopt{
	display: none;
}
.first{
	display: block;
}
#controlDiv{
	float: left;
}
div.smallheader{
	font-size: 150%;
	font-weight: bold;
}
div.smallerheader{
	font-weight: bold;
}
table.methodtable{
	display: inline-block;
	vertical-align: top;
}
#graphTypeDiv{
	position:relative;
	padding-top:10px;
}
#graphSelectionDiv{
	position: absolute;
	top: 10px;
	background: white;
	z-index: 10;
	display: none;
	border: 1px solid black;
	text-align: right;
}
#methodDiv{
	padding-top: 10px;
}
#tDiv{
	padding-top: 10px;
}
button.solveButton{
	margin-top: 10px;
	padding: 10px;
	width: 90%;
}
#tableDiv{
	float: left;
}
#graphDiv{
	float: left;
}
</style>


<script>
// Init Graph and Math stuff ---------------------------------------------------------------------------------------------------------------------
var graphContext;
var width;
var height;
var minX=-10;
var maxX=10;
var minY=-10;
var maxY=10;
var Pi=Math.PI;
var pi=Math.PI;
var e=Math.E;

function cacheMath(){
	var aMathFunctions = Object.getOwnPropertyNames(Math);

	for (var i in aMathFunctions){
		window[aMathFunctions[i]] = Math[aMathFunctions[i]];
	}
}
function fixExponentsOld(s){
	var a=s;
	var re=/\w\^[0-9]*/;
	var re2=/\(\S*\)\^[0-9]/;
	var re3=/\(\S*\)\^\(\S*\)/;
	var re4=/\w\^\(\S*\)/;
	while(re4.test(a)){
		a=a.replace(/(\w*\.?\w*)\^\((\S*)\)/, "Math.pow($1, $2)");
	}
	while(re3.test(a)){
		a=a.replace(/\((\S*)\)\^\((\S*)\)/, "Math.pow($1, $2)");
	}
	while (re2.test(a)){
		a=a.replace(/\((\S*)\)\^([0-9]*\.?[0-9]*)/, "Math.pow($1, $2)");
		}
	while (re.test(a)){
		a=a.replace(/(\w*\.?\w*)\^([0-9]*\.?[0-9]*)/, "Math.pow($1, $2)");
		}

	return a;
	}
function fixExponents(s){
	var i=0;
	var re1=/:OP(\d+):([^]*):CP\1:\s*\^\s*:OP(\d+):([^]*):CP\3:/
	var re2=/:OP(\d+):([^]*):CP\1:\s*\^\s*(\w*)/
	var re3=/(\w*)\s*\^\s*:OP(\d+):([^]*):CP\2:/
	var re4=/(\w*)\s*\^\s*(\w*)/
	while (s.search(/\(([^()]*)\)/)!=-1){
		s=s.replace(/\(([^()]*)\)/, ':OP'+i+':$1:CP'+i+':');
		i++;
	}
	while (s.search(re1) != -1)
		s=s.replace(re1,"pow($2,$4)");
	while (s.search(re2) != -1)
		s=s.replace(re2,"pow($2,$3)");
	while (s.search(re3) != -1)
		s=s.replace(re3,"pow($1,$3)");
	while (s.search(re4) != -1)
		s=s.replace(re4,"pow($1,$2)");
	while (s.search(/:OP\d+:/) != -1)
		s=s.replace(/:OP\d+:/,'(');
	while (s.search(/:CP\d+:/) != -1)
		s=s.replace(/:CP\d+:/,')');
	return(s);
}	
function smash(a, themin, themax){
	if (a<themin)
		return(themin-1);
	else if (a>themax)
		return(themax+1);
	else 
		return(a);
	}
function scaleX(x){
	return (smash(width*(x-minX)/(maxX-minX),0,width));
	}
function scaleY(y){
	return (smash(height-height*(y-minY)/(maxY-minY),0,height));
	}
function unscaleX(x){
	return  ((Math.round(100*(minX+(maxX-minX)*(x/width))))/100);
	}
function unscaleY(y){
	return  ((Math.round(100*(minY+(maxY-minY)*((height-y)/height))))/100);
	}
function drawticks(){
	graphContext.fillStyle='black';
	graphContext.beginPath();
	for (x=width/10.0;x<width;x+=width/10.0){
		graphContext.moveTo(x, scaleY(minY)-3);
		graphContext.lineTo(x, scaleY(minY)+3);
		}
	for (x=height/10.0;x<height;x+=height/10.0){
		graphContext.moveTo(scaleX(minX)-3,x);
		graphContext.lineTo(scaleX(minX)+3,x);
		}
	graphContext.stroke();
	for (x=width/10.0;x<width;x+=width/10.0){
		graphContext.fillText(unscaleX(x), x,scaleY(minY)-15);
		}
	for (x=height/10.0;x<height;x+=height/10.0){
		graphContext.fillText(unscaleY(x), scaleX(minX)+10,x);
		}
	}	
function drawAxis(){
	/*
	graphContext.beginPath();
	graphContext.strokeStyle='black';
	graphContext.moveTo(scaleX(minX), scaleY(0));
	graphContext.lineTo(scaleX(maxX), scaleY(0));
	graphContext.moveTo(scaleX(0), scaleY(minY));
	graphContext.lineTo(scaleX(0), scaleY(maxY));
	graphContext.stroke();
	*/
	drawticks();
	}
function clearGraph(){
	graphContext.fillStyle='lightgray';
	graphContext.fillRect(0,0,width,height);
	drawAxis();
}
function init(){
	graphContext=graph.getContext('2d');
	graphContext.fillStyle='lightgray';
	width=graph.width;
	height=graph.height;
	clearGraph();
	cacheMath();
}
function plotPoints(X,Y,c,d){
	var i;
	graphContext.strokeStyle=c;
	graphContext.setLineDash(d);	
	graphContext.beginPath();
	graphContext.moveTo(scaleX(X[0]),scaleY(Y[0]));
	for (i=1;i<T.length;i++)
		graphContext.lineTo(scaleX(X[i]),scaleY(Y[i]));
	graphContext.stroke();
}

//---------------------------------------------------------------------------------------------------------------------------------------
var numEq = 1;
var theEquations, dxdt,x0,theGraphOptions,graphCheckBoxes,DT,T, euler=[], rk4=[];
var theColors=['gray',
			'black',
			'red',
			'orange',
			'brown',
			'green',
			'blue',
			'indigo',
			'violet',
			'pink',
			];

function init(){
	//graphing stuff
	graphContext=graph.getContext('2d');
	graphContext.fillStyle='lightgray';
	width=graph.width;
	height=graph.height;
	clearGraph();
	cacheMath();
	
	theEquations = document.getElementsByClassName('equation');
	dxdt = document.getElementsByClassName('dxdt');
	x0=document.getElementsByClassName('initial');
	theGraphOptions=document.getElementsByClassName('graphopt');
	graphCheckBoxes=document.getElementsByClassName('graphCheck');
	
	var i;
	for (i=0;i<=9;i++){
		theEquations[i].style.color=theColors[i];
		theGraphOptions[i].style.color=theColors[i];
	}

}
function showEquations(){
	var i;
	for (i=1;i<=9;i++){
		theEquations[i].style.display='none';
		theGraphOptions[i].style.display='none';
	}
	for (i=1;i<=numEq;i++){
		theEquations[i].style.display='block';
		theGraphOptions[i].style.display='block';
	}
	if (numEq >=2)
		theGraphOptions[0].style.display='block';
	else
		theGraphOptions[0].style.display='none';
}
function increaseNumber(){
	var n=eval(numberOfEquations.innerText);
	if (n<9){
		numEq=n+1;
		numberOfEquations.innerText=numEq;
		showEquations();
	}
}
function decreaseNumber(){
	var n=eval(numberOfEquations.innerText);
	if (n>1){
		numEq=n-1;
		numberOfEquations.innerText=numEq;
		showEquations();
	}
	if (numEq==1){
		graphCheckBoxes[1].checked=true;
		preventXY();
	}
}
function showGraphOptions(){
	graphSelectionDiv.style.display='block';
	cover.style.display='block';
}
function hideGraphOptions(){
	graphSelectionDiv.style.display='none';
	cover.style.display='none';
}
function graphXY(){
	for (i=1;i<=9;i++)
		graphCheckBoxes[i].checked=false;
}
function preventXY(){
		graphCheckBoxes[0].checked=false;
}
function setupT(){
	var i,j;
	var max;
	DT=eval(fixExponents(dt.value));
	T=[];
	T[0]=eval(fixExponents(tmin.value));
	max=eval(fixExponents(tmax.value));
	i=0;
	while(eval(T[i].toFixed(8))<eval(max.toFixed(8))){
		i++;		
		T[i]=T[i-1]+DT;
	}
}
function showTable(){

	var i,j;
	var s='<tr><td></td>';
	if (eulerMethod.checked==true) s+='<th colspan='+numEq+'>Euler</th>';
	if (rk4Method.checked==true) s+='<th colspan='+numEq+'>RK4</th>';
	s+='</tr><tr><td>t</td>';
	if (eulerMethod.checked==true)
		for (i=1;i<=numEq;i++)
			s+='<td style="color: '+theColors[i]+';">x<sub>'+i+'</sub></td>';
	if (rk4Method.checked==true)
		for (i=1;i<=numEq;i++)
			s+='<td style="color: '+theColors[i]+';">x<sub>'+i+'</sub></td>';
	s+='</tr>';
	for (j=0;j<T.length;j++){
		s+='<tr><td>'+T[j].toFixed(8)+'</td>';
		if (eulerMethod.checked==true)
			for (i=1;i<=numEq;i++)
				s+='<td style="color: '+theColors[i]+';">'+euler[i][j].toFixed(8)+'</td>';		
		if (rk4Method.checked==true)
			for (i=1;i<=numEq;i++)
				s+='<td style="color: '+theColors[i]+';">'+rk4[i][j].toFixed(8)+'</td>';		
	}
	s+='</tr>';
	dataTable.innerHTML=s;
}
function eulerSolve(){
	var dxdtfcn=[];
	var x1,x2,x3,x4,x5,x6,x7,x8,x9,t,s;
	var i,j,k;
	for (i=1;i<=numEq;i++)
		dxdtfcn[i]=fixExponents(dxdt[i].value);
	for (i=1;i<=numEq;i++){
		euler[i]=[];
		euler[i][0]=eval(fixExponents(x0[i].value));
	}	
	for (j=1;j<T.length;j++){
		for (k=1;k<=numEq;k++){
			s='x'+k+'=euler['+k+']['+(j-1)+'];'
			eval(s);
		}

		t=T[j-1];
		for (i=1;i<=numEq;i++)
			euler[i][j]=euler[i][j-1]+DT*eval(dxdtfcn[i]);
		}
}
function rk4Solve(){
	var dxdtfcn=[];
	var x1,x2,x3,x4,x5,x6,x7,x8,x9,t,s;
	var i,j,k;
	var K1=[];
	var K2=[];
	var K3=[];
	var K4=[];
	for (i=1;i<=numEq;i++)
		dxdtfcn[i]=fixExponents(dxdt[i].value);
	for (i=1;i<=numEq;i++){
		rk4[i]=[];
		rk4[i][0]=eval(fixExponents(x0[i].value));
	}	
	for (j=1;j<T.length;j++){
		//Find K1
		for (k=1;k<=numEq;k++){
			s='x'+k+'=rk4['+k+']['+(j-1)+'];'
			eval(s);
		}
		t=T[j-1];
		for (i=1;i<=numEq;i++)
			K1[i]=eval(dxdtfcn[i]);
		
		
		//Find K2
		for (k=1;k<=numEq;k++){
			s='x'+k+'=rk4['+k+']['+(j-1)+']+DT*K1['+k+']/2;'
			eval(s);
		}
		t=T[j-1]+DT/2;
		for (i=1;i<=numEq;i++)
			K2[i]=eval(dxdtfcn[i]);
		
		//Find K3
		for (k=1;k<=numEq;k++){
			s='x'+k+'=rk4['+k+']['+(j-1)+']+DT*K2['+k+']/2;'
			eval(s);
		}
		t=T[j-1]+DT/2;
		for (i=1;i<=numEq;i++)
			K3[i]=eval(dxdtfcn[i]);
		
		//Find K4
		for (k=1;k<=numEq;k++){
			s='x'+k+'=rk4['+k+']['+(j-1)+']+DT*K3['+k+'];'
			eval(s);
		}
		t=T[j-1]+DT/2;
		for (i=1;i<=numEq;i++)
			K4[i]=eval(dxdtfcn[i]);
		
	for (i=1;i<=numEq;i++)
		rk4[i][j]=rk4[i][j-1]+DT*(K1[i]+2*K2[i]+2*K3[i]+K4[i])/6	;

	}	
}
function setUpAxis(){
	var i,j;
	if (graphCheckBoxes[0].checked == true){
		if (eulerMethod.checked==true){
			minX=euler[1][0];
			maxX=euler[1][0];
			minY=euler[2][0];
			maxY=euler[2][0];
		}
		else{
			minX=rk4[1][0];
			maxX=rk4[1][0];
			minY=rk4[2][0];
			maxY=rk4[2][0];
		}
		if (eulerMethod.checked==true){
			for (i=0;i<T.length;i++){
				if (euler[1][i]<minX) minX=euler[1][i];
				if (euler[1][i]>maxX) maxX=euler[1][i];
				if (euler[2][i]<minY) minY=euler[2][i];
				if (euler[2][i]>maxY) maxY=euler[2][i];
			}
		}
		if (rk4Method.checked==true){
			for (i=0;i<T.length;i++){
				if (rk4[1][i]<minX) minX=rk4[1][i];
				if (rk4[1][i]>maxX) maxX=rk4[1][i];
				if (rk4[2][i]<minY) minY=rk4[2][i];
				if (rk4[2][i]>maxY) maxY=rk4[2][i];
			}		
		}
	}
	else{
		minX=T[0];
		maxX=T[0];
		for (i=0;i<T.length;i++){
			if (T[i]<minX) minX=T[i];
			if (T[i]>maxX) maxX=T[i];
		}
		i=1;
		while(graphCheckBoxes[i].checked==false)
			i++
		if (eulerMethod.checked==true){
			minY=euler[i][0];
			maxY=euler[i][0];
		}
		else{
			minY=rk4[i][0];
			maxY=rk4[i][0];
		}
		if (eulerMethod.checked==true){
			for (i=1;i<=numEq;i++)
				for (j=0;j<T.length;j++)
				if (graphCheckBoxes[i].checked==true){
					if (euler[i][j]<minY) minY=euler[i][j];
					if (euler[i][j]>maxY) maxY=euler[i][j];
				}
		}
		if (rk4Method.checked==true){
			for (i=1;i<=numEq;i++)
				for (j=0;j<T.length;j++)
				if (graphCheckBoxes[i].checked==true){
					if (rk4[i][j]<minY) minY=rk4[i][j];
					if (rk4[i][j]>maxY) maxY=rk4[i][j];
				}		
		}
	}
	clearGraph();
}
function showEulerGraph(){
	if (graphCheckBoxes[0].checked==true)
		plotPoints(euler[1], euler[2],'black',[2]);
	else
		for (i=1;i<=numEq;i++)
			if (graphCheckBoxes[i].checked==true)
				plotPoints(T,euler[i],theColors[i],[2]);
}
function showRK4Graph(){
	if (graphCheckBoxes[0].checked==true)
		plotPoints(rk4[1], rk4[2],'black',[]);
	else
		for (i=1;i<=numEq;i++)
			if (graphCheckBoxes[i].checked==true)
				plotPoints(T,rk4[i],theColors[i],[]);
}
function showGraph(){
	setUpAxis();
	if (eulerMethod.checked == true)
		showEulerGraph();
	if (rk4Method.checked == true)
		showRK4Graph();
}
function solveit(){
	var i,j;
	setupT();
	euler=[];
	rk4=[];
	var i;
	eulerSolve();
	rk4Solve();
	showGraph();
	showTable();
}
</script>
</head>
<body onload='init();'>
<div id='mainDiv'>
	<!-------------------------------------------------------------------->
	<div id='controlDiv'>
		<div class='smallheader'>Nameless DE Solver</div>
		<div id='numEqDiv'>Number of equations:<span id='numberOfEquations' >1</span> <button onclick='increaseNumber();'>&uparrow;</button><button onclick='decreaseNumber();'>&downarrow;</button></div>
		<div id='methodDiv'>
			<div class='smallerheader'>Method</div>
			<input type='checkbox' id='eulerMethod' CHECKED><span>Euler</span>&nbsp;&nbsp;<input type='checkbox' id='rk4Method'><span>RK4</span>
		</div>
		<div id='graphTypeDiv'>
			<div class='smallerheader'>Graph Type <button onclick='showGraphOptions();'>Select</button></div>
			<div id='graphSelectionDiv'>
				<table class='methodtable'>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='graphXY();'> x<sub>2</sub> vs x<sub>1</sub></td></tr>
				<tr class='graphopt first'><td><input type='checkbox' class='graphCheck' onclick='preventXY();' checked> x<sub>1</sub> vs t</td></tr>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='preventXY();'> x<sub>2</sub> vs t</td></tr>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='preventXY();'> x<sub>3</sub> vs t</td></tr>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='preventXY();'> x<sub>4</sub> vs t</td></tr>
				</table>
				<table class='methodtable'>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='preventXY();'> x<sub>5</sub> vs t</td></tr>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='preventXY();'> x<sub>6</sub> vs t</td></tr>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='preventXY();'> x<sub>7</sub> vs t</td></tr>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='preventXY();'> x<sub>8</sub> vs t</td></tr>
				<tr class='graphopt'><td><input type='checkbox' class='graphCheck' onclick='preventXY();'> x<sub>9</sub> vs t</td></tr>
				</table>
				<br>
				<button onclick='hideGraphOptions();'>Close</button>
			</div>	
		</div>		
		<button class='solveButton' onclick='solveit();'>Solve it!</button>
		<div id='tDiv'>
		<table>
			<tr><td class='rightalign'>t<sub>min</sub></td><td>=</td><td> <input type='text' id='tmin' value='0'></td></tr>
			<tr><td class='rightalign'>t<sub>max</sub></td><td>=</td><td> <input type='text' id='tmax' value='1'></td></tr>
			<tr><td class='rightalign'>&Delta;t</td><td>=</td><td> <input type='text' id='dt' value='0.5'></input></td></tr>
		</table>
		</div>
		<div id='equationDiv'>
			<table id='equationTable'>
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>0</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>0</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation first'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>1</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value='2*t'></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>1</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>2</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>2</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>3</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>3</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>4</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>4</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>5</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>5</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>6</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>6</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>7</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>7</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>8</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>8</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
				<tr class='equation'>	<td class='rightalign'><div class='fraction'><div class='numerator'>dx<sub>9</sub></div><div class='denominator'>dt</div></div></td><td>=</td><td> <input type='text' class='dxdt' value=''></td><td>&nbsp;&nbsp;</td><td class='rightalign'>x<sub>9</sub>(t<sub>min</sub>)</td><td>=</td><td><input type='text' class='initial' value='0'></td></tr>		
			</table>
		</div>

	</div>
	<div id='graphDiv'><canvas id='graph' height=600 width=600></canvas></div>
	<div id='tableDiv'><table id='dataTable' border=1></table></div>
	<div id='cover'></div>
</body>
</html>